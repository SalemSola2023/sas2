<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>553c05aff322405ea80aad82c08bb3f2</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="table-of-contents" class="cell markdown" id="lZO86IvJwE9t">
<h2>Table of contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#methodology">Methodology</a></li>
<li><a href="#model_training">Model Definition and Training</a></li>
<li><a href="#model_evaluation">Model Evaluation</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</section>
<section id="introduction-" class="cell markdown" id="X7dlU584pUOD">
<h2>Introduction <a name="introduction"></a></h2>
<p>The aim of this project is to build a time-series model using
<strong>Recurrent Neural Networks (RNNs)</strong> in an attempt to
forecast the value for the next 6 hours.</p>
</section>
<section id="initial-data-exploration-and-feature-engineering"
class="cell markdown" id="jD5bzBDlPKZY">
<h3>Initial Data Exploration and Feature Engineering</h3>
</section>
<div class="cell markdown" id="UnMmaqgAo_BN">
<p>We will be using <a href="https://keras.io/">Keras</a> for our
purpose. Keras is a user-friendly open-source library used for working
with Machine Learning models and runs on top of
<a href="https://www.tensorflow.org/about">Tensorflow</a> which is also
a free and open-source software library that provides you with a
framework for this purpose.</p>
</div>
<div class="cell code" id="3EARjT7ilVYr">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Eager Execution offers an intuitive interface with easier debugging and natural control flow.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tf.compat.v1.enable_eager_execution() </span></code></pre></div>
</div>
<div class="cell markdown" id="qe-GsfbN4wz_">
<p>Let's load and explore the data frame.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:363}"
id="VOEhDRsWMoAW" data-outputId="a44b3b0a-ab80-4e7b-fbb6-cd5599a4cada">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import pandas to load the data.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/dataset.csv&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data frame.</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">

  <div id="df-e139966e-f405-44d3-9197-f4589768a6e2">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>Value</th>
      <th>K1</th>
      <th>K2</th>
      <th>DayN</th>
      <th>K3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01/07/2019 00:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01/07/2019 01:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01/07/2019 02:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01/07/2019 03:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01/07/2019 04:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>01/07/2019 05:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>01/07/2019 06:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>01/07/2019 07:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>01/07/2019 08:00</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>01/07/2019 09:00</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-e139966e-f405-44d3-9197-f4589768a6e2')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-e139966e-f405-44d3-9197-f4589768a6e2 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-e139966e-f405-44d3-9197-f4589768a6e2');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell markdown" id="Sid4MDKU56il">
<p>Before making any major modifications in the data frame, we need to
save some of the most basic information concerning the data. We can use
this information as a reference later on if something goes wrong while
working on it.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="Vwzk2wsvGj-v" data-outputId="e3d473fb-0300-441b-8c32-7733b2997ded">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the date_time column and make it the index.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.date <span class="op">=</span> pd.to_datetime(df[<span class="st">&#39;date&#39;</span>]).dt.strftime(<span class="st">&#39;%m/</span><span class="sc">%d</span><span class="st">/%Y,  %H:%M&#39;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> df[<span class="st">&#39;date&#39;</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the number of rows and columns by using the shape of the data.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>numRows,numColumns <span class="op">=</span> df.shape</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the time interval.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>last_date, first_date <span class="op">=</span> df.iloc[<span class="dv">0</span>].date, df.iloc[<span class="op">-</span><span class="dv">1</span>].date</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the availability of the data.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>na_cols <span class="op">=</span> df.columns[df.isna().<span class="bu">any</span>()].tolist()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the information.</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;There are </span><span class="sc">{</span>numRows<span class="sc">}</span><span class="ss"> rows and </span><span class="sc">{</span>numColumns<span class="sc">}</span><span class="ss"> columns in the initial dataset.&quot;</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;The data represents the time frame between the dates &#39;</span><span class="sc">{</span>last_date<span class="sc">}</span><span class="ss">&#39; and &#39;</span><span class="sc">{</span>first_date<span class="sc">}</span><span class="ss">&#39;.&quot;</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> na_cols:</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;There are no NA rows.&quot;</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f&quot;Columns in the dataset which include NA rows: </span><span class="sc">{</span>na_cols<span class="sc">}</span><span class="ss">.&quot;</span>) </span></code></pre></div>
<div class="output stream stdout">
<pre><code>There are 4416 rows and 6 columns in the initial dataset.
The data represents the time frame between the dates &#39;01/07/2019,  00:00&#39; and &#39;12/31/2019,  23:00&#39;.
There are no NA rows.
</code></pre>
</div>
</div>
<div class="cell markdown" id="4oTls4h-mXSl">
<p>As you can see, the output of the cell above includes significant
information about the time frame and the shape of our data. In the next
cell, we remove all the columns which may not be converted to type
"float64". Any other data type than this (including strings) is not
related to the training process of our model and therefore shall be
omitted.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="3lsI1oetGGH9" data-outputId="8db400d2-56bc-4d3e-c88d-ba448ff37de2">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over each column in df and try to convert its type to float if it&#39;s convertible. </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise remove the column from the data frame.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> df:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].astype(<span class="st">&#39;float&#39;</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    df.drop(column, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display that all the remaining columns are of type &#39;float64&#39;.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code></pre></div>
<div class="output execute_result" data-execution_count="7">
<pre><code>Value    float64
K1       float64
K2       float64
DayN     float64
K3       float64
dtype: object</code></pre>
</div>
</div>
<div class="cell markdown" id="_aOBc5-omo5z">
<p>Before moving on to feature selection, it is good practice to check
some statistical facts for our data set. Let's take our time to look for
anything that seems suspicious and abnormal in the stats.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:300}"
id="j-JVP_n1PEbn" data-outputId="08f0e3b1-ed22-4d18-d80e-9bdf91018702">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic statistics about our data.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">

  <div id="df-a6266298-1918-48b9-9c43-f8bf5473601a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
      <th>K1</th>
      <th>K2</th>
      <th>DayN</th>
      <th>K3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4416.000000</td>
      <td>4416.000000</td>
      <td>4416.000000</td>
      <td>4416.000000</td>
      <td>4416.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>8.314085</td>
      <td>0.617527</td>
      <td>0.615942</td>
      <td>2.972826</td>
      <td>1.817029</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.330135</td>
      <td>1.182450</td>
      <td>1.341779</td>
      <td>2.006825</td>
      <td>0.751014</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>7.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>9.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>10.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>14.000000</td>
      <td>9.000000</td>
      <td>11.000000</td>
      <td>6.000000</td>
      <td>3.000000</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-a6266298-1918-48b9-9c43-f8bf5473601a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-a6266298-1918-48b9-9c43-f8bf5473601a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-a6266298-1918-48b9-9c43-f8bf5473601a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell markdown" id="11p4tR19AQSA">
<p>We have to know how different columns relate to each other. We will
use the <em>Pearson Correlation Coefficient</em> for this step. We don't
want to include all the columns because it is important to use as few
variables as possible during training. This will improve the accuracy of
our model as well as reduce training time and the amount of information
loss.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="fk3_CJGlruK2" data-outputId="bab7c0ac-f4ec-44aa-e736-36c9f0d99992">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between each feature and the Value.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df.corr(<span class="st">&#39;pearson&#39;</span>).Value</span></code></pre></div>
<div class="output execute_result" data-execution_count="9">
<pre><code>Value    1.000000
K1       0.115705
K2      -0.176281
DayN    -0.074560
K3       0.925536
Name: Value, dtype: float64</code></pre>
</div>
</div>
<div class="cell code" id="JupYpi2vrxpK">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following libraries are used for data manipulation and visualization.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pylab</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the style of the graphs. This is optional.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;dark_background&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="YdkDjpBh4DDD">
<p>After importing the necessary libraries, we will now plot a graph
showing us once more, but this time more clearly, how the features
correlate.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:990}"
id="WFIXobI4uMJZ" data-outputId="feae3efb-be16-47b4-8048-a62a218b190b">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new variable containing the selected features to continue with.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> df[[<span class="st">&#39;Value&#39;</span>,<span class="st">&#39;K1&#39;</span>,<span class="st">&#39;K2&#39;</span>,<span class="st">&#39;K3&#39;</span>,<span class="st">&#39;DayN&#39;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               ]]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the correlation matrix.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">25</span>)) </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>) <span class="co"># 1x1 grid, first subplot.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>fig.colorbar(ax.matshow(features.corr(), vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)) </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> np.arange(<span class="bu">len</span>(features.columns))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(ticks)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(ticks)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(features.columns)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(features.columns)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Correlation Matrix&quot;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/c4a8df0ef6e0fba8a72b238c806a55afb980aabb.png" /></p>
</div>
</div>
<div class="cell markdown" id="xg59pof21r3M">
<p>To verify that the features are in the correct format, let's plot
graphs for each seperate feature and observe how they evolve over
time.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:782}"
id="v7IAtpI9uRqZ" data-outputId="8ccbd1c1-4fbc-4bd9-c8e6-8d2e3bebb88a">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot which shows how the selected features change over time.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>features.plot(subplots<span class="op">=</span><span class="va">True</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">10</span>),title<span class="op">=</span><span class="st">&#39;Selected Features&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="12">
<pre><code>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7efedb71e2b0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7efedb69d190&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7efedb6c03a0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7efedb66f4f0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7efedb61e610&gt;],
      dtype=object)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/ac94a7b256105971e5c6a1879df874880c02e274.png" /></p>
</div>
</div>
<div class="cell markdown" id="WJrgK7TjxbLT">
<p>It is incredibly important to normalize the data set within the
specified range. This may help the learning algorithm to work faster and
more efficiently. MinMaxScaler is an algorithm which does exactly this.
It transforms all the values and fits them in a range between 0 and
1.</p>
</div>
<div class="cell code" id="BIwrvlKxu2Nn">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scikit-learn is a free software machine learning library. </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the data using MinMaxScaler within the range 0 to 1 and assign the scaled data to a new variable.</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler(feature_range<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> scaler.fit_transform(features.values)</span></code></pre></div>
</div>
<section id="methodology-" class="cell markdown" id="ngfCdMZFuPoj">
<h2>Methodology <a name="methodology"></a></h2>
<p>In this project, we will try to build a model which learns from data
in the form of time-series and then predicts the new timesteps. To
achieve this, we will use RNNs because they are arguably the best type
of machine learning algorithm for our case. Until this step, we have
obtained the required data, cleaned and explored it and selected the
appropriate features for training the model. Then we have eliminated
some of the features after examining the Pearson correlation matrix. The
reason we are not using all the features is that it would not increase
model performance, on the contrary, it would decrease it because when we
train an ML model which takes multivariate data as input, the learning
algorithm applies feature reduction to the data and some information is
lost in the course of this task. This situation is called the Curse of
Dimensionality. We don't want too much data being lost, so we only
choose the features that are essential for the objective. The following
step of our project is the actual building/training process. Then we
will evaluate the model using the appropriate methods.</p>
</section>
<section id="model-definition-and-training-" class="cell markdown"
id="9WAgPVl9iHgS">
<h2>Model Definition and Training <a name="model_training"></a></h2>
</section>
<section id="compiling-the-model" class="cell markdown"
id="rRWdVYNzM1Kr">
<h3>Compiling the Model</h3>
</section>
<div class="cell markdown" id="OOzxS8_w5GuI">
<p>It is recommended that you study the code for this step in true
detail and understand how it works.</p>
<p>First, we define two variables; "past" represents the number of hours
our model will be able to look into the past and "future" represents the
number of hours our model will predict into the future.</p>
<p>We then define the <strong>batch size</strong> and the
<strong>train/test splitting point</strong>. The <em>batch size</em> is
a hyperparameter which represents the number of samples used before
updating the model weights. After working with different batch sizes,
we've decided to use 256 separate batches to train our model. We will
use the SPLIT variable for splitting the data into train data and test
data. In order to calculate the splitting point, we used; the batch
size, the shape of our data and a test percentage of ~0.33.</p>
<p>After we specify this information, we split the data into two
separate parts using the splitting point. The first one is used for
training the model and the rest is used as validation data. We also
create a variable called "indices" which holds the index values of the
test set for visualization.</p>
</div>
<div class="cell code" id="1kEq8djYcuf0">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The model will be able to &quot;see&quot; the weather belonging to past 5 days (120 hours). </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>past <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The model should be able to forecast the Value for the next 24 hours.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>future <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>SPLIT <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Use list comprehensions for splitting the data into train and test sets.</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>x_train, y_train <span class="op">=</span> <span class="bu">map</span>(np.array, <span class="bu">zip</span>(<span class="op">*</span>[(dataset[<span class="bu">range</span>(k<span class="op">-</span>past, k)], dataset[:,<span class="dv">1</span>][k:k<span class="op">+</span>future]) <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(past, SPLIT)]))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>x_test, y_test <span class="op">=</span> <span class="bu">map</span>(np.array, <span class="bu">zip</span>(<span class="op">*</span>[(dataset[<span class="bu">range</span>(k<span class="op">-</span>past, k)], dataset[:,<span class="dv">1</span>][k:k<span class="op">+</span>future]) <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(SPLIT<span class="op">+</span>past, <span class="bu">len</span>(dataset)<span class="op">-</span>future)]))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="bu">range</span>(k<span class="op">-</span>past, k<span class="op">+</span>future, future) <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(SPLIT<span class="op">+</span>past, <span class="bu">len</span>(dataset)<span class="op">-</span>future)]</span></code></pre></div>
</div>
<div class="cell markdown" id="iUHmL6NsbSO9">
<p>One of the most important things to pay attention to while forming
the train and test sets is the fact that we are shuffling the training
data before we feed it to the model. The reason for this is that the
original data is nonstationary, meaning that it involves seasonality.
Removing seasonality in a dataset to make it stationary, more often than
not improves the model performance. If we wanted to, we could check
whether our data was stationary or not by computing some statistical
tests, such as KPSS and ADF. However, it would be beyond the scope of
this project since this is an introductory notebook.</p>
</div>
<div class="cell code" id="8txR7OXbbNZW">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shuffle training data to remove seasonality.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> tf.data.Dataset.from_tensor_slices((x_train, y_train))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> train_data.cache().shuffle(<span class="dv">10000</span>).batch(BATCH_SIZE).repeat()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Do NOT shuffle test data.</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> tf.data.Dataset.from_tensor_slices((x_test, y_test))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> test_data.batch(BATCH_SIZE).repeat()</span></code></pre></div>
</div>
<div class="cell markdown" id="z7ZmKUU6Bqr_">
<p>Let's define and then compile the model. We start by adding two LSTM
(a specialized RNN) layers to our model and a final Dense layer which is
used to connect each input neuron to an output neuron and has the shape
equal to the output dimension, i.e. the number of hours we want to
predict. We decided to use
<a href="https://www.researchgate.net/publication/323956667_Deep_Learning_using_Rectified_Linear_Units_ReLU">ReLU
(Rectified Linear Units)</a> as our activation function, since it is
particularly famous as it overcomes the Vanishing Gradient problem. It
is also useful if you are a beginner as it's generally adaptable to many
different cases.</p>
<p>In order to compile the model, we need to pass an optimizer as an
argument to the <em>compile()</em> method. While there is no standard
recipe for choosing a learning method for a model, RMSprop is an
optimizer which uses an adaptive learning rate and it works generally
well with big datasets. So we will go with that one.</p>
<p>It is recommended that you don't modify the following cell a lot,
unless you possess advanced knowledge of the domain.</p>
</div>
<div class="cell code" id="9XLJA28TBlUh">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a Sequential Model.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tf.keras.models.Sequential()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add layers to the model. </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>model.add(tf.keras.layers.LSTM(<span class="dv">32</span>, return_sequences<span class="op">=</span><span class="va">True</span>, input_shape<span class="op">=</span>(x_train.shape[<span class="dv">1</span>],x_train.shape[<span class="dv">2</span>])))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>model.add(tf.keras.layers.LSTM(<span class="dv">16</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>model.add(tf.keras.layers.Dense(future))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the model.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>tf.keras.optimizers.RMSprop(clipvalue<span class="op">=</span><span class="fl">1.0</span>), loss<span class="op">=</span><span class="st">&#39;mae&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="ZjEpmiBpMmwZ" data-outputId="6907f84f-a799-4ff7-faaf-8f46dd43c18b">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a summary representation of our model.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm (LSTM)                 (None, 120, 32)           4864      
                                                                 
 lstm_1 (LSTM)               (None, 16)                3136      
                                                                 
 dense (Dense)               (None, 6)                 102       
                                                                 
=================================================================
Total params: 8,102
Trainable params: 8,102
Non-trainable params: 0
_________________________________________________________________
</code></pre>
</div>
</div>
<section id="training-the-model" class="cell markdown"
id="07YGSK9BM6_H">
<h3>Training the Model</h3>
</section>
<div class="cell markdown" id="wBIrHzDZMtoP">
<p>So, how do we fit the data into the model? While this step is pretty
straightforward, there are some things you should pay attention to.
First of all, you should specify the number of epochs, steps per epoch,
validation data and validation steps arguments. You can increase the
number of steps for better results. Another thing to keep in mind is
that the fit() method also returns a complete history of the training
process apart from doing the actual training task. We will assign a
variable to this method for keeping a record of the training loss and
the validation loss.</p>
<p>When you execute the following cell, the training will begin and it
is likely to take some time. If you don't want to wait, you can skip
this step by adjusting the number of epochs and the number of steps per
epoch or you can download the pre-trained model from GitHub and upload
it to the notebook.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="q_AoxJwIyWlA" data-outputId="ac9498f2-6f5b-4982-9111-6018d5525d0d">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># An epoch refers to a cycle through the training set.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Since one entire cycle is too big in our case, use steps.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>STEPS_PER_EPOCH <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the data into the model.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> model.fit(train_data, epochs<span class="op">=</span>EPOCHS,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                 steps_per_epoch<span class="op">=</span>STEPS_PER_EPOCH,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                 validation_data<span class="op">=</span>test_data,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                 validation_steps<span class="op">=</span><span class="dv">500</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/2
1000/1000 [==============================] - 162s 159ms/step - loss: 0.0644 - val_loss: 0.0688
Epoch 2/2
1000/1000 [==============================] - 156s 156ms/step - loss: 0.0643 - val_loss: 0.0688
</code></pre>
</div>
</div>
<div class="cell code" id="deGK239PPoHs">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PATH = &#39;.../istanbul_weather_model.h5&#39;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># model = tf.keras.models.load_model(PATH)</span></span></code></pre></div>
</div>
<section id="model-evaluation-" class="cell markdown" id="cmWywHynil1I">
<h2>Model Evaluation <a name="model_evaluation"></a></h2>
</section>
<div class="cell markdown" id="RCp0OrIjBbxd">
<p>If we train the model more than we should, the model starts
hallucinating non-existent patterns and the accuracy starts to decrease
instead of increasing, then we call this situation
"<strong>overfitting</strong>". To detect this and prevent it from
happening, we keep record of the loss functions during the training
step. Since the size of our training set is pretty large, it is unlikely
that we are overfitting but there is no harm in checking.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:295}"
id="XV66vJejyq_K" data-outputId="a2b934ae-f237-445f-a864-37baa655d169">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize a plot of loss on the training and validations sets over training epochs.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(hist.history[<span class="st">&#39;loss&#39;</span>])), hist.history[<span class="st">&#39;loss&#39;</span>], <span class="st">&#39;b&#39;</span>, label<span class="op">=</span><span class="st">&#39;Training loss&#39;</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(hist.history[<span class="st">&#39;val_loss&#39;</span>])), hist.history[<span class="st">&#39;val_loss&#39;</span>], <span class="st">&#39;r&#39;</span>, label<span class="op">=</span><span class="st">&#39;Validation loss&#39;</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Training History&#39;</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Mean Absolute Error&quot;</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/404a7bcc74e03bc4d18d5542918f066c314047ce.png" /></p>
</div>
</div>
<div class="cell markdown" id="pJzRz3VPG4C1">
<p>We have chosen the <em>Root Mean Squared Error (RMSE)</em> as our
evaluation metric. It is calculated by taking the square root of square
of the difference between the test data and the predictions made by the
model. What we are going to do is to take samples from the validation
data and make predictions for each of them. We will plot our forecast
and the real values on a graph. Finally, we will calculate the error and
add that to the graph too. What's good about this metric is that it
prevents large errors and in our case large errors are undesirable.
Additionally, thanks to the existance of the square root in RMSE
formula, the scale of errors is the same as the scale of target
values.</p>
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/336b47cc4f121599bf6b33a3cb147824165f5947.png"
alt="RMSE Formula" /></p>
</div>
<div class="cell markdown" id="rwbRAlDibJur">
<p>##Forecasting</p>
</div>
<div class="cell markdown" id="3e3ixFe_xHM9">
<p>Finally, let's plot the predictions created by using the test data.
We will look at these examples for evaluating the performance of our
model.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="puvGUN3HQqHZ" data-outputId="df1b6fd4-a8b5-4a78-a3df-bf753e687ef0">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FormatStrFormatter</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep track of iterations and specify the number of predictions to be made.</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>iter_num <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>NUMBER_OF_PREDICTIONS <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> test_data.take(NUMBER_OF_PREDICTIONS): </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  iter_num <span class="op">=</span> iter_num <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unscale history.</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  history <span class="op">=</span> scaler.inverse_transform(x[<span class="dv">0</span>].numpy())</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unscale true future.</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  ground_truth <span class="op">=</span> np.transpose(np.insert(np.zeros([features.shape[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>,future]),<span class="dv">1</span>,y[<span class="dv">0</span>],<span class="dv">0</span>))</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  ground_truth <span class="op">=</span> scaler.inverse_transform(ground_truth)[:,<span class="dv">1</span>]</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unscale forecasted values.</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  prediction <span class="op">=</span> np.transpose(np.insert(np.zeros([features.shape[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>,future]),<span class="dv">1</span>,model.predict(x)[<span class="dv">0</span>],<span class="dv">0</span>))</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  prediction <span class="op">=</span> scaler.inverse_transform(prediction)[:,<span class="dv">1</span>]</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate RMSE.</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  rmse <span class="op">=</span> sqrt(mean_squared_error(ground_truth,prediction))</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot the graph.</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  timeframe <span class="op">=</span> np.arange(<span class="bu">len</span>(history[:,<span class="dv">1</span>]),<span class="bu">len</span>(history[:,<span class="dv">1</span>])<span class="op">+</span><span class="bu">len</span>(ground_truth))</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(history[:,<span class="dv">1</span>])),</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>           np.array(history[:,<span class="dv">1</span>]),</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="st">&#39;History&#39;</span>)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  plt.plot(timeframe, </span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>           np.array(ground_truth), <span class="st">&#39;c:&#39;</span>, </span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="st">&#39;True Future&#39;</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  plt.plot(timeframe, </span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>           np.array(prediction), <span class="st">&#39;mx&#39;</span>,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="st">&#39;Predicted Future&#39;</span>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  fig.autofmt_xdate() <span class="co"># Rotate the x-labels so that they don&#39;t overlap.</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  plt.legend(loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  plt.ylabel(<span class="st">&quot;Value&quot;</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  plt.title(<span class="st">&quot;Value Forecast #&quot;</span><span class="op">+</span><span class="bu">str</span>(iter_num<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  ax.grid(<span class="va">False</span>) <span class="co"># Remove the grid.</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  plt.text(<span class="fl">0.02</span>,<span class="fl">0.81</span>,<span class="st">&quot;RMSE: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> rmse,</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>           ha<span class="op">=</span><span class="st">&#39;left&#39;</span>, va<span class="op">=</span><span class="st">&#39;top&#39;</span>,</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>           transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/b2804f568b4334316f84ed3ad0d918220e06d91a.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 20ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/2917d473657724f58d79b09a0cb4e254c7667b51.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/de02864d4e9334828157408f548476ff4e016096.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 20ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/af229f2a94c29e260a7a03615c44266fe05ca2a1.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/a769b99991aee705b5ce93e1e60f5f8eb53344e3.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/13540d196a12117fe794ef5e7b04b663cf6e6136.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/90392a49580fdf829d33354f2cdc48e2f69b466e.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 24ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/245cd7faf4c03911d14f6866305d3a1981913245.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/fbcbc71188e0a1df28773b2317d12bd27d6e3384.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/d54060a91ddc98aefd3b75413eca3255299f72ea.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/b24afae7490e6a2f8f7f52dcc6d51c4684a5f825.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/057c89e4d1c52549de72023e3e67e627d031aa1b.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/7b37e060fd87b59211a564f8c8f659db53ebe86c.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/c06d9465ece4d17b229101192c6bcc8ffe7353a9.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/e5814d0f88635693ef74e5e6d627d2e9bf6568ed.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>2/2 [==============================] - 0s 27ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/c3c406d70b9404778db83db444abe0c0f117f9e7.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/a990d4dd80f5826607cfd97c3159969a592f8f26.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/93863bae8a353abe7a05c7e1d3b02d4b773a55db.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/82e28be27d3d7e41f563337e4aec897857ae33b8.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/01bdaa103a7f8fd9784740ac93891a539e008922.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/f30f02ff97207866da942221b9090a152da525b6.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/d4fe16a65d761bcfca791eedc6dd9ce41d4c93e8.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 21ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/25a74165f34c7842e48b7fb51024c741ec50eec6.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/f74c5586ac869ae70bac94645e9dbe23530995fd.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/48f6aab050aa3a1e98bf2b89b61578ed6fcf01d9.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 40ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/8ce60ea733dc8569a5bae61d0a94076f11a6a232.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 32ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/53ee3a86c8d251d39ff115d6a9251c4e8f2875b7.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/9a9899e169e2e2a0bc47c6ca90bf18b61896bc90.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 36ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/97b4938761ee0f076752553d3b7d263007ce37d8.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 39ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/2514c7acda178043cd9d523d203a1d8a9607b8ec.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/d27a9d315c6e6e2a91534f7d891e14651f49c1c8.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>2/2 [==============================] - 0s 40ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/341fa388f97ec3fe323aa97b60a8217948a42b05.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 42ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/786cbdde87edbdd6ebec9806bdb8c56a2923704e.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 32ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/bc063f8bf6faf76094eb7717cdd9ca0b8f5efc29.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 33ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/47d9e2c03377df6c24e1f35cf0bf7311f54ebf75.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/97615129629e06883f89bd135d4f04703a342ca5.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 24ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/7dd4296ca65acd93b21e886df33a67e92799a6cb.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/19ebe66f5b6c3ad5132f2939d294d015e689f887.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/1cac3964c3f6400ad8d366e3627f38897d210161.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/cc65e381c08facdfbc7af58e8f293d6de5ffb197.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 23ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/cb362614b0306a388a8b25a34db0136884b614fa.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 24ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/da2a2a754d6247369048ca3f7eb6a8391283942c.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 25ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/2e23badecbfb0456aca376045c53e25f7ec06b0e.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 24ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/82b27480076ce30537d844c3dc413556594e0424.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 25ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/81ee227a0cb4c0c69393f34a86b1ae5802457194.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 25ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/a5f12ecc5bf4169f4266e95ad5f564d596f5351e.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 25ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/935cfbf9a8fb171e057c4f7ba4587ef9cc752e3c.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>2/2 [==============================] - 0s 27ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/bd1fa35655add63c399250b5e75c0cd50b77b54f.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 24ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/c01abc7276776223247b6deead6e82b3000f2bd5.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>8/8 [==============================] - 0s 22ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_57e5bcb6fe2a4dcf82fe969a118135ca/df941f5645a6ff796bb362bd23dbe24eff7f56f5.png" /></p>
</div>
</div>
<div class="cell markdown" id="yzUIC9-_Lc4s">
<p>The forecasts look pretty close to reality in general, meaning that
we have reached our goal at this point. Finally, it is time to save our
model, so that we can apply it to new data if we want to.</p>
</div>
<div class="cell markdown" id="34t3GOMIWkTC">
<p>look prediction in next 6hours</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="WvRJ4FtEWiOi" data-outputId="1ef7de20-3eb9-49c3-9d36-0c1e7fd9c1eb">
<div class="sourceCode" id="cb75"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>prediction</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">
<pre><code>array([ 0.00696206, -0.00045644,  0.0083656 ,  0.00107853, -0.00326649,
        0.00377787])</code></pre>
</div>
</div>
<div class="cell code" id="TlAWnVwsi15m">
<div class="sourceCode" id="cb77"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the model to a desired path.</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>model.save(<span class="st">&quot;model.h5&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="BakLKnQscLwM" data-outputId="b1034693-39e0-43d9-b531-5c9b8d0e400c">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>joblib.dump(model, <span class="st">&#39;model.pkl&#39;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>WARNING:absl:Found untraced functions such as lstm_cell_layer_call_fn, lstm_cell_layer_call_and_return_conditional_losses while saving (showing 2 of 2). These functions will not be directly callable after loading.
</code></pre>
</div>
<div class="output execute_result" data-execution_count="26">
<pre><code>[&#39;model.pkl&#39;]</code></pre>
</div>
</div>
<section id="conclusion-" class="cell markdown" id="eQWFq4gAi4pn">
<h2>Conclusion <a name="conclusion"></a></h2>
</section>
<div class="cell markdown" id="8UNteVp_ryu5">
<p>In this notebook, we have used weather data to train a model which is
able to predict the value, 6 hours into the future. A similar approach
can be used for other time series data which resemble the one in our
case, for example stock prices.</p>
</div>
</body>
</html>
